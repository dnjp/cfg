#!/bin/sh

capstoescape() {
	setxkbmap -option caps:escape
}

capstoescapectrl() {
	setxkbmap us
	setxkbmap -option ctrl:nocaps
	setxkbmap -option 'caps:ctrl_modifier'
	xcape -e 'Control_L=Escape' -t 200
}

settings() {
	# increase repeat rate
	xset r rate 200 100
}

usage() {
	echo "usage: kb [ flags ]"
	cat <<'EOF'
flags:
  -e
	Re-map Caps Lock to Escape
  -c
	Re-map Caps Lock to Escape when pressed and Ctrl when held
  -s
	Set sensible defaults for keyboard
EOF
}

while getopts :cehs flag
do
	case ${flag} in
	e) 
		capstoescape
		;;	
	c) 
		capstoescapectrl
		;;
	s) 
		settings
		;;
	h)
		usage
		exit 1
		;;
	*)
		usage
		exit 1
	esac
done

if [ $OPTIND -eq 1 ]; then 
	usage
	exit 1
fi

settings
